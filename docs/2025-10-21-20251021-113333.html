<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Maturing bigtonk.com development</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/monokai-sublime.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
        <meta name="description" content="blogdor" />
      </head>
  <body>
    <header>
      <h1 class="site-title"><a href="index.html">trog.codes</a></h1>
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="archive.html">Archive</a></li>
          <!-- <li><a href="about.html">About</a></li> -->
          <li><a href="mailto:root@trog.codes">Contact</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <article>
        <h1 class="post-title">Maturing bigtonk.com development</h1>
                <div class="post-date">Posted on: 2025-10-21
11:33:33</div>
         <p>Not too long ago I released
<a href="https://bigtonk.com">this site</a> to consolidate several
services under one platform for the owner. Things like Linktree,
Patreon, Shopify, etc…all services that take a cut and have their own
entire ecosystem you have to keep track of.</p>
<p>In recent days I have discovered how extensible
<a href="https://medusajs.com/">MedusaJS</a> is. There is a
well-documented and fairly robust way to add data models to the Medusa
database:</p>
<p><img src="../images/medusa-module.png" alt="files in a medusa module" width=800 /></p>
<p>The files above are all you need to get CRUD-ready services powered
by Mikro-ORM, which you don’t have to write anything for except data
models and extend a service class with those.</p>
<p>From there, you can write “workflows”, which are just functions with
access to the Medusa container - their name for the dependency injection
container - with full access to your generated services. These workflows
can contain multiple “steps”, each with their own rollback logic to run
on failure:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { InferTypeOf } <span class="im">from</span> <span class="st">&quot;@medusajs/framework/types&quot;</span><span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> Linkrow <span class="im">from</span> <span class="st">&quot;../modules/linktree/models/linkrow&quot;</span><span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  createStep<span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  createWorkflow<span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  StepResponse<span class="op">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  WorkflowResponse<span class="op">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>} <span class="im">from</span> <span class="st">&quot;@medusajs/framework/workflows-sdk&quot;</span><span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> LinkTreeModuleService <span class="im">from</span> <span class="st">&quot;modules/linktree/service&quot;</span><span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { LINKTREE_MODULE } <span class="im">from</span> <span class="st">&quot;modules/linktree&quot;</span><span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> LinkTreeRow <span class="op">=</span> InferTypeOf<span class="op">&lt;</span><span class="kw">typeof</span> Linkrow<span class="op">&gt;;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">export type</span> CreateLinkrowWorkflowInput <span class="op">=</span> <span class="bu">Omit</span><span class="op">&lt;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  LinkTreeRow<span class="op">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;id&quot;</span> <span class="op">|</span> <span class="st">&quot;created_at&quot;</span> <span class="op">|</span> <span class="st">&quot;updated_at&quot;</span> <span class="op">|</span> <span class="st">&quot;deleted_at&quot;</span> <span class="op">|</span> <span class="st">&quot;photo&quot;</span> <span class="op">|</span> <span class="st">&quot;tags&quot;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> createLinkrowStep <span class="op">=</span> <span class="fu">createStep</span>(</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;create-linkrow&quot;</span><span class="op">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> (linkrowInput<span class="op">:</span> CreateLinkrowWorkflowInput<span class="op">,</span> { container }) <span class="kw">=&gt;</span> {</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> linktreeModuleService<span class="op">:</span> LinkTreeModuleService <span class="op">=</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      container<span class="op">.</span><span class="fu">resolve</span>(LINKTREE_MODULE)<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> linkrow <span class="op">=</span> <span class="cf">await</span> linktreeModuleService<span class="op">.</span><span class="fu">createLinkrows</span>({</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>linkrowInput<span class="op">,</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">StepResponse</span>(linkrow<span class="op">,</span> linkrow)<span class="op">;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> (linkrow<span class="op">,</span> { container }) <span class="kw">=&gt;</span> {</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> linktreeModuleService<span class="op">:</span> LinkTreeModuleService <span class="op">=</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>      container<span class="op">.</span><span class="fu">resolve</span>(LINKTREE_MODULE)<span class="op">;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> linktreeModuleService<span class="op">.</span><span class="fu">deleteLinkrows</span>(linkrow<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> createLinkrowWorkflow <span class="op">=</span> <span class="fu">createWorkflow</span>(</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;create-linkrow&quot;</span><span class="op">,</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  (linkrowInput<span class="op">:</span> CreateLinkrowWorkflowInput) <span class="kw">=&gt;</span> {</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> linkrow <span class="op">=</span> <span class="fu">createLinkrowStep</span>(linkrowInput)<span class="op">;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">WorkflowResponse</span>(linkrow)<span class="op">;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div>
<p>These workflows can then be called from elsewhere in the application,
such as API routes, scheduled jobs, or internal event handlers (of which
there are many).</p>
<p>An example of calling the above workflow from a custom API
endpoint:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="im">type</span> { MedusaRequest<span class="op">,</span> MedusaResponse } <span class="im">from</span> <span class="st">&quot;@medusajs/framework/http&quot;</span><span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  createLinkrowWorkflow<span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  CreateLinkrowWorkflowInput<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>} <span class="im">from</span> <span class="st">&quot;../../../workflows/create-linkrow&quot;</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { ContainerRegistrationKeys } <span class="im">from</span> <span class="st">&quot;@medusajs/framework/utils&quot;</span><span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  req<span class="op">:</span> MedusaRequest<span class="op">&lt;</span>CreateLinkrowWorkflowInput<span class="op">&gt;,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  res<span class="op">:</span> MedusaResponse<span class="op">,</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> req<span class="op">.</span><span class="at">body</span><span class="op">;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { result<span class="op">:</span> linkrow } <span class="op">=</span> <span class="cf">await</span> <span class="fu">createLinkrowWorkflow</span>(req<span class="op">.</span><span class="at">scope</span>)<span class="op">.</span><span class="fu">run</span>({</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    input<span class="op">,</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    linkrow<span class="op">,</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">GET</span>(req<span class="op">:</span> MedusaRequest<span class="op">,</span> res<span class="op">:</span> MedusaResponse) {</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> query <span class="op">=</span> req<span class="op">.</span><span class="at">scope</span><span class="op">.</span><span class="fu">resolve</span>(ContainerRegistrationKeys<span class="op">.</span><span class="at">QUERY</span>)<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { data<span class="op">:</span> linkrows } <span class="op">=</span> <span class="cf">await</span> query<span class="op">.</span><span class="fu">graph</span>({</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    entity<span class="op">:</span> <span class="st">&quot;linkrow&quot;</span><span class="op">,</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    fields<span class="op">:</span> [</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;id&quot;</span><span class="op">,</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;text&quot;</span><span class="op">,</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;description&quot;</span><span class="op">,</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;href&quot;</span><span class="op">,</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;order&quot;</span><span class="op">,</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;active&quot;</span><span class="op">,</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;category&quot;</span><span class="op">,</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">json</span>({ linkrows })<span class="op">;</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>I then call this API endpoint from a custom route added to the admin
UI, on a page which I then use to manage the linktree links in the same
place I manage products, customers, and everything else. It’s all in one
database cluster together, super fast, and super accessible to both the
frontend and for back office purposes.</p>
<p>The custom page:</p>
<p><img src="../images/medusa-linktree.png" alt="files in a medusa module" width=800 /></p>
<hr />
<p>I am now about half-done with doing this process for the Youtube
video showcase on the site as well. I made the models, service, etc, am
writing a workflow now, which I intend to call not from an API route
this time but from a scheduled job, to replace the same thing I have
running on a Railway function worker and talking to a separate
database.</p>
      </article>
    </main>

    <footer>
      <div class="visitor-counter">
        “Programming is a Dark Art, and it always will be. The programmer is
        fighting against the two most destructive forces in the universe:
        entropy and human stupidity. These are not things you can overcome with
        a “methodology” or on a schedule.” - Damian Conway
      </div>
      <div class="retro-elements">
        <a href="index.html">Home</a> | <a href="archive.html">Archive</a> |
        <!-- <a href="about.html">About</a> | -->
        <a href="mailto:root@trog.codes">Contact</a> |
        <a href="https://github.com/rconjoe/blogdor">Source</a>
      </div>
    </footer>
  </body>
</html>
